\documentclass[a4paper,12pt]{article}
\usepackage{amsmath, amssymb, hyperref, listings}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{textgreek}

\geometry{margin=1in}
\setlength\parindent{0pt}

\title{CoringTreespotters Model notes}
\author{Christophe}
\date{\today}


\begin{document}

\maketitle

\section*{15 April 2025}
Quick notes after meeting with Victor, where we discussed the preliminary steps for building a model to address how juvenile trees respond to climate change. I’d like to frame this in terms of the recruitment capacity of tree saplings—looking at how their growth varies across years and how it’s influenced by temperature and the length of the growing season (or perhaps not the length specifically... more on that below).

\section{Come up with a model}

\subsection*{What are my predictors?}
We discussed which of the following would be the most relevant variable that relates to growth:
\begin{enumerate}
	\item \textbf{Growing Degree Days (GDD)} which would be calculated between the budburst and budset date of each individual. 
	\item \textbf{Growing Season Length (GSL)} which could be calculated by:
	\begin{enumerate}
		\item Substracting budset DOY by budburst DOY or 
		\item By taking the number of days of each year when the mean (or max/min) was above 5$^{\circ}$C (or maybe the nb of consecutive days when the temperature was above 5 or something like that).
	\end{enumerate}
\end{enumerate}

\[
\begin{aligned}
&\textbf{Likelihood:} \\
y_{i} &\sim \mathcal{N}(\mu_{i}, \sigma_y^2), \\
\mu_{i} &= \alpha + \alpha_{\text{spp}} + \alpha_{\text{spp[ids]}} + \beta \cdot gdd \\[1em]
&\textbf{Simulated coefficients:} \\
\alpha & = 1.5 \\
\alpha_{\text{spp}} &\sim \mathcal{N}(0, \sigma_{\text{spp}}) \\
\alpha_{\text{spp[ids]}} &\sim \mathcal{N}(\alpha_{\text{spp}}, \sigma_{\text{ids}}) \\
\beta & = 0.4, \\
\sigma_{y} &= 0.2 \\
\sigma_{\text{spp}} & = 0.3\\
\sigma_{\text{ids}} & = 0.15 \\
gdd & \sim \mathcal{N}(1800, 200) 
\end{aligned}
\]


\textbf{Where:} \\ 
$\alpha$: overall intercept \\ 
$\alpha_{\text{spp}, j}$: each species intercept deviation from the overall intercept\\ 
$\alpha_{\text{ids}, i(j)}$: each ids interecept deviation from the overall intercept, nested within each species\\
$\beta$: overall slope
$gdd$: growing degree days. Measured from budburst to budset (theoretical start and end of tree primary growth)

\subsection*{Lizzie's notation after bayesian working group:}
\textbf{Nested on the intercept without provenance}\\
$ y_i \sim \text{normal}(\mu, \sigma_y)$\\
$ \mu =  \alpha + \alpha_{sp[id]} + \beta*gdd$\\
$ \alpha_{sp} \sim \text{normal}(0, \sigma_{\alpha sp})$\\
$ \alpha_{sp[id]} \sim \text{normal}(\alpha_{sp}, \sigma_{\alpha id})$ \\

\textbf{Nested on the intercept with provenance---Option 1}\\
$ y_i \sim \text{normal}(\mu, \sigma_y)$\\
$ \mu =  \alpha + \alpha_{sp[id]} + \alpha_{prov} + \beta*gdd$\\
$ \alpha_{sp} \sim \text{normal}(0, \sigma_{\alpha sp})$\\
$ \alpha_{sp[id]} \sim \text{normal}(\alpha_{sp}, \sigma_{\alpha id})$\\
$ \alpha_{prov} \sim \text{normal}(0, \sigma_{\alpha prov})$ \\

\textbf{Nested on the intercept without provenance---Option 2}\\
\[
\begin{aligned}
ringwidth_i &\sim \text{Normal}(\mu, \sigma_y) \\
\mu &= \alpha + \alpha_{\text{species}} + \alpha_{\text{site}} + \alpha_{\text{treeid}} + \beta \, * gdd \\
\alpha_{\text{species}} &\sim \text{Normal}(0, \sigma_{\alpha \, \text{species}}) \\
\alpha_{\text{site}} &\sim \text{Normal}(0, \sigma_{\alpha \, \text{site}}) \\
\alpha_{\text{treeid}} &\sim \text{Normal}(0, \sigma_{\alpha \, \text{treeid}})
\end{aligned}
\]


% with slope
\[
\begin{aligned}
ringwidth_i &\sim \text{Normal}(\mu, \sigma_y) \\
\mu &= \alpha + \alpha_{\text{site}} + \alpha_{\text{treeid}} + \beta \, * gdd + \beta_{\text{species}}\, * gdd \\
\alpha_{\text{site}} &\sim \text{Normal}(0, \sigma_{\alpha \, \text{site}}) \\
\alpha_{\text{treeid}} &\sim \text{Normal}(0, \sigma_{\alpha \, \text{treeid}}) \\
\beta_{\text{species}} &\sim \text{Normal}(0, \sigma_{\beta \, \text{species}}) \\
\end{aligned}
\]



\textit{Notes on option 1 vs option 2}: Charles pointed out during the working group that opt 1 and 2 were actually the same thing. After chatting with Lizzie on 8-09-2025, we concluded that he was right and to simplify the code, we will use option 2.

\subsection*{Model update after simulating the data}

\subsection*{Model Specification}

\textbf{Data:}
\begin{itemize}
    \item $i = 1, \dots, N$ (observations)
    \item $j[i] = 1, \dots, J$ (site indices for each observation)
    \item $y_i$: Tree ring width measurement
    \item $x_i$: Growing Degree Days (GDD) covariate
\end{itemize}

\textbf{Parameters:}
\begin{itemize}
    \item Site-level intercepts: $\alpha_j$ ($j = 1, \dots, J$)
    \item Site-level slopes: $\beta_j$ ($j = 1, \dots, J$)
    \item Population means: $\mu_\alpha$, $\mu_\beta$
    \item Population variances: $\sigma_\alpha$, $\sigma_\beta$
    \item Measurement error: $\sigma_y$
\end{itemize}

\subsection*{Model Structure}

\begin{align*}
&\text{Measurement model:} \\
&y_i \sim \mathcal{N}(\hat{y}_i, \sigma_y^2) \\
&\hat{y}_i = \alpha_{j[i]} + \beta_{j[i]} \cdot x_i \\[2ex]
%
&\text{Site-level parameters:} \\
&\alpha_j \sim \mathcal{N}(\mu_\alpha, \sigma_\alpha^2) \\
&\beta_j \sim \mathcal{N}(\mu_\beta, \sigma_\beta^2) \\[2ex]
%
&\text{Hyperpriors:} \\
&\sigma_y \sim \text{Uniform}(0, 100) \\
&\sigma_\alpha \sim \text{Uniform}(0, 100) \\
&\sigma_\beta \sim \text{Uniform}(0, 100) \\
&\mu_\alpha \sim \mathcal{N}(0, 100) \quad \text{(weakly informative)} \\
&\mu_\beta \sim \mathcal{N}(0, 100) \quad \text{(weakly informative)}
\end{align*}

\subsection*{Key Features}

\begin{itemize}
    \item \textbf{Partially pooled slopes:} Each site $j$ has its own GDD response $\beta_j$, drawn from a shared normal distribution
    \item \textbf{Adaptive shrinkage:} The estimated $\sigma_\beta$ controls pooling strength (smaller values $\Rightarrow$ stronger pooling toward $\mu_\beta$)
    \item \textbf{Interpretation:}
    \begin{itemize}
        \item $\mu_\beta$: Overall average effect of GDD on tree growth
        \item $\sigma_\beta$: Between-site variability in GDD sensitivity
        \item $\beta_j$: Site-specific growth response to GDD
    \end{itemize}
\end{itemize}




\section{Simulate data}
I arbitrarily decided to sum up the GDD between DOY 100 and 300 for data simulation. \\
yhat: combine the effects that I generated from the grand mean, the year effect (other than variation of GDD), individual effect, species response to GDD and the overall error, which returns my yhat i.e. ring width in mm.

\section{Set your priors}

\section{Run model on empirical data}

\section{Perform retrodictive checks using the model fit to your empirical data}

\section{Mis}

\newpage
\textit{Below I will be stating the o bvious because I want to make sure I understand the notations and stuff. The steps will be notes and thoughts that I have when I code my model in R.}

\end{document}
